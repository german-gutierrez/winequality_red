---
title: "winequality"
author: "Germán y Óscar"
date: "5/31/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Descripción del dataset

Este Dataset contiene los datos fisicoquimicos y sensoriales correspondientes a la variación roja del vino portugués "Vinho Verde". Las variables son las siguientes:

1. fixed acidity: ácidos no volatiles que no se evaporan fácilmente.

2. volatile acidity: indica el contenido de ácido acético en el vino, un alto contenido produce un desagradable sabor a vinagre.

3. citric acid: actúa como conservante para aumentar la acidez. En pequeñas cantidades aporta frescura y sabor al vino.

4. residual sugar: es la cantidad de azucar restante despues de la fermantación.Los vinos con más de 45g/l son dulces.

5. chlorides: La cantidad de sal que tiene el vino.

6. free sulfur dioxide: previene el crecimiento de microbios y la oxidación del vino.

7. total sulfur dioxide: Es la cantidad total (libres + ligadas) de SO2 del vino.

8. density: densidad del vino. Los vinos dulces tienen una mayor densidad.

9. pH: el nivel de acidez.

10. sulphates: un aditivo del vino que contribuye a los niveles de SO2 y actia como antimicrobiano y antioxidante.

11. alcohol: la cantidad de alcohol que contiene el vino.

12. quality: calidad del vino (puntuación entre 0 y 10).

### ¿Por qué es importante y qué pregunta/problema pretende responder?

El objetivo de este análisis es observar la relación entre las variables fisicoquímicas y la calidad del vino, e intentar predecir la calidad a partir de estas.

Este estudio puede ser de gran utilidad en cualquier sector relacionado con el vino, especialmente en bodegas, que pueden usar estos datos para mejorar la calidad de sus vinos.

## Integración y selección de los datos de interés a analizar.

Para este análisis trabajaremos con el dataset winequality-red disponible en la siguiente URL: https://www.kaggle.com/uciml/red-wine-quality-cortez-et-al-2009

Lo primero que haremos es cargar el dataset:

```{r}
wineData <- read.csv('winequality-red.csv', sep=",")
head(wineData)
```

Observamos la correlación entre las diferentes variables para decidir si podemos prescindir de alguna variable redundante.

```{r}
cor(wineData)
heatmap(x = cor(wineData), symm = TRUE)
```

Observamos que las variables más correlacionadas son:
fixed.acidity y density: tienen una correlación de 0.66804729
fixed.acidity y citric.acid: tienen una correlación de 0.67170343
total.sulfur.dioxide y free.sulfur.dioxide: tienen una correlación de 0.667666450

## Limpieza de los datos.


### ¿Los datos contienen ceros o elementos vacíos?

Una vez cargado el dataset comprobamos si este contiene elementos nulos o vacíos.

```{r}
colSums(is.na(wineData))
```
Observamos que no tiene elementos vacíos.

Comprobamos si el dataset contiene ceros.

```{r}
colSums(wineData==0)
```
Vemos que la única columna que contiene zeros es "citric.acid" con 132 registros.

### ¿Cómo gestionarías cada uno de estos casos?

Hemos visto que para la única variable que tenemos ceros es "citric.acid". Sospechamos que posiblemente, y más habiendo 132 registros con valor zero, sea relativamente frecuente encontrar algunos vinos sin ácido cítrico.

Procedemos a ver más detalladamente las estadísticas de esta variable.

```{r}
summary(wineData[,3])
```

Observamos que el primer cuartil tiene un valor de 0.090, la media de 0.260 y el valor máximo es 1. Viendo que hay valores tan cercanos a 0, asumimos que los 132 registros no son campos vacíos y simplemente significan que ese vino no contiene ácido cítrico. 

### Identificación y tratamiento de valores extremos.

Para la identificación de outliers utilizaremos los boxplots, que permite recuperar los valores de los outliers además de representarlos gráficamente.

```{r}
boxplot.stats(wineData$fixed.acidity)$out
boxplot(wineData$fixed.acidity,
  ylab = "fixed.acidity"
)
```
```{r}
boxplot.stats(wineData$volatile.acidity)$out
boxplot(wineData$volatile.acidity,
  ylab = "volatile.acidity"
)

```

```{r}
boxplot.stats(wineData$citric.acid)$out
boxplot(wineData$citric.acid,
  ylab = "citric.acid"
)
```

```{r}
boxplot.stats(wineData$residual.sugar)$out
boxplot(wineData$residual.sugar,
  ylab = "residual.sugar"
)
```

```{r}
boxplot.stats(wineData$chlorides)$out
boxplot(wineData$chlorides,
  ylab = "chlorides"
)
```

```{r}
boxplot.stats(wineData$free.sulfur.dioxide)$out
boxplot(wineData$free.sulfur.dioxide,
  ylab = "free.sulfur.dioxide"
)
```

```{r}
boxplot.stats(wineData$total.sulfur.dioxide)$out
boxplot(wineData$total.sulfur.dioxide,
  ylab = "total.sulfur.dioxide"
)
```

```{r}
boxplot.stats(wineData$density)$out
boxplot(wineData$density,
  ylab = "density"
)
```

```{r}
boxplot.stats(wineData$pH)$out
boxplot(wineData$pH,
  ylab = "pH"
)
```

```{r}
boxplot.stats(wineData$sulphates)$out
boxplot(wineData$sulphates,
  ylab = "sulphates"
)
```

```{r}
boxplot.stats(wineData$alcohol)$out
boxplot(wineData$alcohol,
  ylab = "alcohol"
)
```

A continuación mostramos algunas estadísticas del dataset como la media y el valor máximo de las variables que pueden resultarnos útiles a la hora de identificar mejor los outliers

```{r}
summary(wineData) 
```


Observamos que todas las variables presentan outliers.

Los outliers más alejados de la media son:

residual.sugar
free.sulfur.dioxide
total.sulfur.dioxide

Observamos la distribución de la calidad de los vinos de estos outliers.

```{r}
residual.sugar.outliers.quality = wineData$quality[wineData$residual.sugar %in% boxplot.stats(wineData$residual.sugar)$out]

hist(residual.sugar.outliers.quality)

```
```{r}
free.sulfur.dioxide.outliers.quality = wineData$quality[wineData$free.sulfur.dioxide %in% boxplot.stats(wineData$free.sulfur.dioxide)$out]

hist(free.sulfur.dioxide.outliers.quality)
```

```{r}
total.sulfur.dioxide.outliers.quality = wineData$quality[wineData$total.sulfur.dioxide %in% boxplot.stats(wineData$total.sulfur.dioxide)$out]

hist(total.sulfur.dioxide.outliers.quality)
```
Observamos que los outliers de residual.sugar siguen una distribución normal, mientras que los outliers tanto de free.sulfur.dioxide como de 
total.sulfur.dioxide adquieren principalmente valores de calidad de 5.

Previamente hemos visto que la correlación entre residual.sugar y quality era muy baja (0.013731637) por lo que tiene sentido que aún en los outliers observemos diferentes valores para quality con una distribución normal.

La correlación entre quality y free.sulfur.dioxide, y quality y total.sulfur.dioxide también es relativamente baja, -0.050656057 y -0.18510029 respectivamente. En estos casos podemos observar que estos outliers coinciden con una calidad mediocre del vino (5 en la mayoría de casos).

Una vez analizados los outliers asumimos que estos valores no son datos erroneos, por lo que no los eliminaremos.

## Análisis de los datos.

### Selección de los grupos de datos que se quieren analizar/comparar (planificación de los análisis a aplicar).

En este apartado de análisis de datos tendremos el objetivo de identificar qué es lo que un vino sea bueno, es decir, que hace que su calidad sea alta.

Intentaremos conocer cuales son las características que influyen en la calidad del vino, evaluando la relación de la variable calidad con el resto de variables del dataset.

### Comprobación de la normalidad y homogeneidad de la varianza.

Comprobaremos la nornmalidad y homogeneidad de la varianza para cada una de las variables del dataset.

- Primero visualizaremos los Q-Q Plots de cada uno de los campos del dataset:

```{r}
par(mfrow=c(2,2))
for (i in 1:ncol(wineData)){
    qqnorm(wineData[,i],main = paste ("Q-Q Normal plot", colnames(wineData)[i]))
    qqline(wineData[,i],col="red")
}
```

Después de realizar los Q-Q Plots y observar que en principio las variable serían candidatas a normalidad, realizamos también el test de Shapiro para cada una de ellas:

```{r}
shapiro.test(wineData$quality)
shapiro.test(wineData$fixed.acidity)
shapiro.test(wineData$volatile.acidity)
shapiro.test(wineData$citric.acid)
shapiro.test(wineData$residual.sugar)
shapiro.test(wineData$chlorides)
shapiro.test(wineData$free.sulfur.dioxide)
shapiro.test(wineData$total.sulfur.dioxide)
shapiro.test(wineData$density)
shapiro.test(wineData$pH)
shapiro.test(wineData$sulphates)
shapiro.test(wineData$alcohol)
```

```{r}
```

### Aplicación de pruebas estadísticas para comparar los grupos de datos.

Empezaremos visualizando las correlaciones entre quality y las tres variables que tienen una correlación más alta (alcohol, citric.acid y sulphates).

Primero vamos a visualizar como se relacionan entre ellas uno a uno, es decir, la calidad del vino con cada una de las variables. Visualizamos dos gráficas, una de correlaciones típicas y otra de correlación por distribución de boxplot.

Visualizamos la corelación entre quality y alcohol. Observamos como a mayor cantidad de alcohol más calidad en el vino.

```{r}
library(ggplot2)
ggplot(aes(x = quality, y = alcohol), data = wineData) + geom_point(alpha = 0.30, position = 'jitter') +
  coord_cartesian(xlim = c(0,10))

boxplot(alcohol~quality, data = wineData,
    xlab = "Quality",
    ylab = "Alcohol")
```

Visualizamos la corelación entre quality y citric.acid. Observamos como a mayor cantidad de citric.acid más calidad en el vino.

```{r}
library(ggplot2)
ggplot(aes(x = quality, y = citric.acid), data = wineData) + geom_point(alpha = 0.30, position = 'jitter') +
  coord_cartesian(xlim = c(0,10))

boxplot(citric.acid~quality, data = wineData,
    xlab = "Quality",
    ylab = "Citric Acid")
```

Visualizamos la corelación entre quality y sulphates.Observamos como a mayor cantidad de sulphates más calidad en el vino, aunque la correlación tiene menos fuerza que las dos observadas anteriormente.

```{r}
library(ggplot2)
ggplot(aes(x = quality, y = sulphates), data = wineData) + geom_point(alpha = 0.30, position = 'jitter') +
  coord_cartesian(xlim = c(0,10))

boxplot(sulphates~quality, data = wineData,
    xlab = "Quality", ylab = "Sulphates") 
```

Ahora vamos a pasar a visualizar la correlación de la calidad del vino con parejas de los tres elementos que hemos visto.

Empezamos visualizacon la correlación de quality con citric.acid y alcohol. Observamos como a mayor cantidad de ambos, la calidad tiende a ser superior. Aunque observamos que estos dos factores no explican toda la variabilidad de quality.


```{r}
ggplot(aes(x = citric.acid, y = alcohol, color = quality),
  data = wineData) + geom_point() +
  scale_color_gradientn(colors = rainbow(5)) 
```

Empezamos visualizacon la correlación de quality con sulphates y alcohol. De forma similar a la gráfica anterior observamos como a mayor cantidad de ambos, la calidad tiende a ser superior. Igual que en el caso anterior observamos que estos dos factores no explican toda la variabilidad de quality.

```{r}
ggplot(aes(x = sulphates, y = alcohol, color = quality),
  data = wineData) + geom_point() +
  scale_color_gradientn(colors = rainbow(5)) 
```

Ahora realizaremos dos análisis con la creación de modelos de regresión lineal, concretamente utilizaremos dos modelos:

- Modelo de regresión lineal con todas las variables del dataset.
- Modelo de regresión lineal con solo las variables con mayor correlación

Realizamos modelo de regresión lineal con todas las variables del dataset.

```{r}
model_linear <- lm(quality ~., data = wineData)
summary(model_linear)
```

Observamos como la mayoría de variables tienen un impacto nulo o muy bajo en relación con la calidad. Las variables que tienen un impacto mayor son alcohol y sulphates.

Observando el valor de R^2, podemos explicar  aproximadamente un 35% de la variabilidad de quality.

Realizamos modelo de regresión lineal con solo las variables con mayor correlación.

```{r}
model_linear_sig <- lm(quality ~ citric.acid + sulphates + alcohol, data = wineData)
summary(model_linear_sig)
```

Observamos como la variable con mayor influencia en quality es alcohol, seguida a distancia por sulphates y citric.acid.

Con estas tres variables podemos explicar un 28% de la variabilidad de quality. Un dato bastante similar al que obtenemos con todas las variables del dataset.

## Resolución del problema.

El objetivo del análisis era entender cuales son las características químicas que definen a un buen vino. El análisis nos ha permitido identificar cuales son las variables con influencia en la calidad del vino y cuales tienen muy poca o nula influencia.

### ¿cuáles son las conclusiones?

Las variables alcohol, sulphates y citric.acid son las que tienen más influencia en la calidad del vino, y explican solo por sí mismas un 28% de la variabilidad. El resto de variables explican un 7% más de la variabilidad del vino, por lo tanto individualmente tienen muy poca influencia en la calidad.

### ¿Los resultados permiten responder al problema?

Los resultados nos permiten conocer mejor algunas de las causas químicas de la calidad del vino pero no nos permiten comprender en un porcentaje alto de variabilidad los factores que determinan la calidad. Con los datos disponibles solo llegamos a un tercio de la variabilidad. Para mejorar estos datos necesitaríamos variables adicionales y una mejor comprensión del concepto de la calidad en el vino.

## Contribuciones

| Contribuciones              | Firma    |
|-----------------------------|----------|
| Investigación previa        | GGC, OAA |
| Redacción de las respuestas | GGC, OAA |
| Desarrollo código           | GGC, OAA |


